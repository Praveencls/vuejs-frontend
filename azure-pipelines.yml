trigger:
  - master # change to main if your default branch is main

pool:
  vmImage: ubuntu-latest

variables:
  - group:
      AIcommerce_group # must contain:
      # AZURE_STATIC_WEB_APPS_API_TOKEN
      # VITE_API_BASE_URL

steps:
  - task: NodeTool@0
    inputs:
      versionSpec: '22.x'
    displayName: 'Use Node 18'

  # ðŸ”¥ Inject Vite production environment variable
  - script: |
      echo "VITE_API_BASE_URL=$(VITE_API_BASE_URL)" > .env.production
    displayName: 'Create .env.production'

  - script: |
      npm ci
      npm run build
    displayName: 'Install and Build'

  - task: AzureStaticWebApp@0
    inputs:
      app_location: '/'
      output_location: 'dist'
      skip_app_build: true
      azure_static_web_apps_api_token: $(AZURE_STATIC_WEB_APPS_API_TOKEN)
